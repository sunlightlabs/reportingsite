{% extends "willard/willard_base.html" %}

{% load media %}
{% load humanize %}
{% load willard_filters %}

{% block content %}


<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js"></script>
{% js "js/jquery.sparkline.min.js "%}

<div style="float: right;">
    <h3 style="text-align: center;">Top registration issues:<br/>past year</h2>
    <div id="monthLineChart"></div>
    <br/><br/>
    <h3 style="text-align: center;">Browse lobbying issues</h2>
    <h3 style="text-align: center;font-size:.9em;">Registrations in the past 12 months</h2>
    <ul class="issueChart" style="width: 450px;">
        {% for issue in issues %}
        <li>
            <a href="{{ issue.get_absolute_url }}">
                <span style="display: block; float: left; width: 300px;">{{ issue.issue }}</span>
                <span class="inlinesparkline">{{ issue.counts_by_month }}</span>
            </a>
            <span class="count">{{ issue.num|intcomma }}</span>
            <span class="index" style="width: {{ issue.num|percentage:past_year_count|intcomma }}%"></span>
        </li>
        {% endfor %}
    </ul>


</div>

<div id="registrationList" style="width: 350px;">
    {% for dategroup in object_list %}
    <h4 style="margin-bottom: 5px;">{{ dategroup.date|date:"F j" }}</h4>
    <ul style="margin-bottom: 40px;">
        {% for registration in dategroup.registrations %}
            {% include "willard/registration_list_item.html" %}
        {% endfor %}
    </ul>
    {% endfor %}
</div>


<script type="text/javascript" charset="utf-8" src="http://assets.sunlightfoundation.com.s3.amazonaws.com/reporting/1.0/js/highcharts.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'monthLineChart',
                width: '500',
                height: '350',
                defaultSeriesType: 'line',
                marginTop: -40,
                animation: false,
                backgroundColor: '#f1f1ef'
            },
            credits: { enabled: false },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    marker: { 
                        radius: 4
                    },
                    lineWidth: 2,
                    shadow: false
                }
            },
            legend: { 
                layout: 'horizontal',
                borderWidth: 0,
                itemWidth: 200,
                width: 500
            },
            title: { 
                text: '',
                style: {
                    display: 'none',
                    position: 'absolute',
                    left: '0',
                    top: '0',
                }
            },
            tooltip: {
                borderRadius: 0,
                borderWidth: 0,
                formatter: function() {
                    return '<b>'+ this.y +' registrations</b>';
                }
            },
            yAxis: {
                min: 0,
                title: { text: 'Number of registrations' }
            },
            xAxis: {
                categories: [
                {% for month in months %}
                '{{ month }}'{% if not forloop.last %},{% endif %}
                {% endfor %}
                ]
            },

            series: [
            {% for issue, months in issue_counts %}
            {
                name: '{{ issue }}',
                data: [
                    {% for month in months %}
                    {{ month }}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                    ]
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
            ]

        });

        // Create inline sparklines
        $('.inlinesparkline').sparkline('html', {
                                fillColor: false,  
                                spotRadius: 0,
                                lineColor: '#414042'
                                //lineColor: '#ff0000'
                            });

    });
</script>

{% endblock content %}
