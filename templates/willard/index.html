{% extends "willard/willard_base.html" %}

{% load media %}
{% load humanize %}
{% load willard_filters %}

{% block content %}

{% js "js/jquery.sparkline.min.js "%}


{% block breadcrumb %}{% endblock %}

<div class="registrationList">
    <a style="display: block; float: right;margin-top:10px;" href="{% url willard_feed %}"><img src="http://assets.sunlightfoundation.com.s3.amazonaws.com/reporting/1.0/img/feed-icon-14x14.png" alt="RSS" title="Subscribe to an RSS feed of the latest lobbyist registrations" style="border: 0;" /></a>
    <h2 style="font-size:1.75em;">Latest registrations</h2>
    {% for dategroup in object_list %}
    <h3 style="margin-bottom: 8px;font-size:1.25em;">{{ dategroup.date|date:"F j" }}</h3>
    <ul style="margin-bottom: 40px;">
        {% for registration in dategroup.registrations %}
            {% include "willard/registration_list_item.html" %}
        {% endfor %}
    </ul>
    {% endfor %}
</div>

<div style="width:500px;">
    <p>The Lobbying Disclosure Act requires lobbyists to register with the House and the Senate <a href="http://www.senate.gov/legislative/Lobbying/Lobby_Disclosure_Act/4_Registration_of_Lobbyists.htm">within 45 days of being hired by a client</a>. The registrations list the issue areas that will be covered by the lobbying. This database allows users to see those registrations as they're submitted, to browse by issue, registrant and client, and to see the trends in issues and registrations over time. The database is updated weekly based on Senate records.</p> 
    <br />

    <div id="registrations_month">
        <h3 style="text-align: center; font-size: 1.5em;">Past 30 days of registrations</h3>
        <a href="#year" class="toggler" id="toggle_year">View past 12 months</a>
        <div id="monthLineChart" style="width:525px;height:300px;"></div>
        <h3 style="text-align: center; font-size: 1.25em;">Browse by issue</h3>
        <ul class="issueChart" style="width: 475px;">
            {% for issue in past_month_issues %}
            <li>
                <a href="{{ issue.get_absolute_url }}">
                    <span style="display: block; float: left; width: 310px;">{{ issue.issue }}</span>
                    <span class="inlinesparkline" style="color:#f1f1ef;">{{ issue.counts_by_day }}</span>
                </a>
                <span class="count">{{ issue.past_month_count|intcomma }}</span>
                <span class="index" style="width: {{ issue.past_month_count|percentage:past_month_count|intcomma }}%"></span>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div id="registrations_year" style="display: none;">
        <h3 style="text-align: center; font-size: 1.5em;">Past 12 months of registrations</h3>
        <a href="#month" class="toggler" id="toggle_month">View past 30 days</a>
        <div id="yearLineChart" style="width:525px;height:300px;"></div>
        <h3 style="text-align: center; font-size: 1.25em;">Browse by issue</h3>
        <ul class="issueChart" style="width: 475px;">
            {% for issue in issues %}
            <li>
                <a href="{{ issue.get_absolute_url }}">
                    <span style="display: block; float: left; width: 310px;">{{ issue.issue }}</span>
                    <span class="inlinesparkline" style="color:#f1f1ef;">{{ issue.counts_by_month }}</span>
                </a>
                <span class="count">{{ issue.num|intcomma }}</span>
                <span class="index" style="width: {{ issue.num|percentage:past_year_count|intcomma }}%"></span>
            </li>
            {% endfor %}
        </ul>
    </div>

</div>



<script type="text/javascript" charset="utf-8" src="http://assets.sunlightfoundation.com.s3.amazonaws.com/reporting/1.0/js/highcharts.js"></script>

<script type="text/javascript">
    $(document).ready(function () {

        // Create inline sparklines
        $('.inlinesparkline').sparkline('html', { fillColor: false,  spotRadius: 0, lineColor: '#414042' });

        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'yearLineChart',
                width: '525',
                height: '300',
                defaultSeriesType: 'line',
                marginTop: -25,
                marginLeft: 50,
                animation: false,
                backgroundColor: '#f1f1ef'
            },
            credits: { enabled: false },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    marker: { 
                        radius: 3
                    },
                    lineWidth: 2,
                    color: '#2a5f65',
                    shadow: false
                }
            },
            legend: {
                        enabled: false
            },
            title: {
                text: '',
                style: { display: 'none', position: 'absolute', left: '0', top: '0', }
            },
            tooltip: {
                borderRadius: 0,
                borderWidth: 0,
                formatter: function() {
                    return '<b>' + this.point.name + ': ' + this.y + ' registrations</b>';
                }
            },
            yAxis: {
                min: 0,
                     title: { text: 'Number of registrations',
                              style: { color: '#414042' }
                     }
            },
            xAxis: {
                categories: [ {% for month, registrations in registrations_by_month %} '{{ month.month_initial }}'{% if not forloop.last %},{% endif %} {% endfor %} ],
                    title: { text: 'Month',
                        style: { color: '#414042' }
                    }
            },

            series: [
            {
                name: 'Lobbyist registrations',
                data: [ {% for month, registrations in registrations_by_month %} { y: {{ registrations }}, name: '{{ month.month_name }} {{ month.year }}' }{% if not forloop.last %},{% endif %} {% endfor %} ]
            }
            ]
        });


        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'monthLineChart',
                width: '525',
                height: '300',
                defaultSeriesType: 'line',
                marginTop: -25,
                marginLeft: 50,
                animation: false,
                backgroundColor: '#f1f1ef'
            },
            credits: { enabled: false },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    marker: { 
                        radius: 3
                    },
                    lineWidth: 2,
                    color: '#2a5f65',
                    shadow: false
                }
            },
            legend: {
                        enabled: false
            },
            title: {
                text: '',
                style: { display: 'none', position: 'absolute', left: '0', top: '0', }
            },
            tooltip: {
                borderRadius: 0,
                borderWidth: 0,
                formatter: function() {
                    return '<b>' + this.point.name + ': ' + this.y + ' registrations</b>';
                }
            },
            yAxis: {
                min: 0,
                     title: { text: 'Number of registrations',
                              style: { color: '#414042' }
                     }
            },
            xAxis: {
                categories: [ {% for day, registrations in registrations_by_day %} '{% cycle day|date:"n/j" " " " " " " " " %}'{% if not forloop.last %},{% endif %} {% endfor %} ],
                    title: { text: 'Date',
                        style: { color: '#414042' }
                    }
            },

            series: [
            {
                name: 'Lobbyist registrations',
                data: [ {% for day, registrations in registrations_by_day %} { y: {{ registrations }}, name: '{{ day|date:"n/j" }}' }{% if not forloop.last %},{% endif %} {% endfor %} ]
            }
            ]

        });

        var showMonth = function () {
            $("#registrations_year").hide();
            $("#registrations_month").show();
            $.sparkline_display_visible()
        }

        var showYear = function () {
            $("#registrations_month").hide();
            $("#registrations_year").show();
            $.sparkline_display_visible()
        }

        if (window.location.hash == '#year') {
            showYear();
        }

        $("#toggle_year").bind('click', function() {
            showYear();
        });
        $("#toggle_month").bind('click', function() {
            showMonth();
        });

    });
</script>

{% endblock content %}
