{% extends "buckley/buckley_base.html" %}

{% block content %}

<script type="text/javascript">
var outsideSpending; 
$(document).ready(function() {
      var total = {{ total.total }};
      outsideSpending = new Highcharts.Chart({
         chart: {
            renderTo: 'outside-spending-pie',
            defaultSeriesType: 'pie'
         },
         title: {
            text: 'Outside spending'
         },
        tooltip: {
                 formatter: function() {
                    return '<b>'+ this.point.name +'</b>: '+ Math.round((this.y/total)*100) +' %';
                 }
              },

        legend: {
                 layout: 'horizontal'
              },
        series: [{
                 type: 'pie',
                 name: 'Outside spending',
                 data: [
                    ['Independent expenditures',   {{ total.ie_total }}],
                    ['Electioneering communications',       {{ total.ec_total }}],
                 ]
              }]
      });

      var partyTotal = {{ total.republican_support_total }} + {{ total.republican_oppose_total }} + {{ total.democrat_support_total }} + {{ total.democrat_oppose_total }};
    partyVsNonparty = new Highcharts.Chart({
        chart: {
            renderTo: 'party-pie',
            defaultSeriesType: 'pie',
        },
        title: {
            text: 'Outside spending by candidate party'
        },
        tooltip: {
                 formatter: function() {
                    return '<b>'+ this.point.name +'</b>: '+ Math.round((this.y/partyTotal)*100) +' %';
                 }
      },
        legend: {
            layout: 'horizontal'
        },
        series: [{
            type: 'pie',
            name: 'Outside spending by candidate party',
            data: [
            ['Supporting Republicans/Opposing Democrats', {{ total.republican_support_total }} + {{ total.democrat_oppose_total }}],
            ['Supporting Democrats/Opposing Republicans', {{ total.democrat_support_total }} + {{ total.republican_oppose_total }}]
            ]
        }]
    });

    var partyCommitteeTotal = {{ total.republican_support_party }} + {{ total.republican_oppose_party }} + {{ total.democrat_support_party }} + {{ total.democrat_oppose_party }};
    var nonpartyCommitteeTotal = {{ total.republican_support_nonparty }} + {{ total.republican_oppose_nonparty }} + {{ total.democrat_support_nonparty }} + {{ total.democrat_oppose_nonparty }};
    partyCommitteeVsNonpartyCommittee = new Highcharts.Chart({
        chart: {
            renderTo: 'party-committee-pie',
            defaultSeriesType: 'pie'
        },
        title: {
            text: 'Outside spending: Party committees vs. Non-party committees'
        },
        tooltip: {
                 formatter: function() {
                    return '<b>'+ this.point.name +'</b>: '+ Math.round((this.y/partyTotal)*100) +' %';
                 }
      },
        legend: {
            layout: 'horizontal'
        },
        series: [{
            type: 'pie',
            name: 'Outside spending by candidate party',
            data: [
            ['Party committees', partyCommitteeTotal],
            ['Non-party committees', nonpartyCommitteeTotal]
            ]
        }]
    });

    committeeChart = new Highcharts.Chart({
        chart: {
            renderTo: 'committee-barchart',
            defaultSeriesType: 'bar',
        },
        title: {
            text: 'Top spenders in past 4 days'
        },
        xAxis: {
         categories: [
            {% for committee in top_committees|slice:"5" %}
            '{{ committee.committee }}'{% if not forloop.last %},{% endif %}
            {% endfor %}
         ],
          labels: {
            rotation: -45,
            align: 'right',
            style: {
                font: 'normal 10px Verdana, sans-serif'
            }
         }
      },
        yAxis: {
                 min: 0,
                 title: {
                    text: 'Amount spent'
                 }
              },
       plotOptions: {
         column: {
            stacking: 'normal'
         }
        },

        tooltip: {
                 formatter: function() {
                    return '<b>$'+ Math.round(this.y);
                 }
      },
        series: [
                { data: [{% for committee in top_committees|slice:"5" %}{{ committee.amount }}{% if not forloop.last %},{% endif %}{% endfor %}]
                }
                ],
        legend: { enabled: false }
    });

    raceChart = new Highcharts.Chart({
        chart: {
            renderTo: 'race-barchart',
            defaultSeriesType: 'bar',
        },
        title: {
            text: 'Top races in past 4 days'
        },
        xAxis: {
         categories: [
            {% for race in top_races|slice:"5" %}
            '{{ race.race }}'{% if not forloop.last %},{% endif %}
            {% endfor %}
         ],
      },
        yAxis: {
                 min: 0,
                 title: {
                    text: 'Amount spent'
                 }
              },
       plotOptions: {
         column: {
            stacking: 'normal'
         }
        },

        tooltip: {
                 formatter: function() {
                    return '<b>$'+ Math.round(this.y);
                 }
      },
        series: [
                { data: [{% for race in top_races|slice:"5" %}{{ race.amount }}{% if not forloop.last %},{% endif %}{% endfor %}]
                }
                ],
        legend: { enabled: false }
    });

    candidateChart = new Highcharts.Chart({
        chart: {
            renderTo: 'candidate-barchart',
            defaultSeriesType: 'bar',
        },
        title: {
            text: 'Top candidates in past 4 days'
        },
        xAxis: {
         categories: [
            {% for candidate in top_candidates|slice:"5" %}
            '{{ candidate.candidate }}'{% if not forloop.last %},{% endif %}
            {% endfor %}
         ],
          labels: {
            rotation: -45,
            align: 'right',
            style: {
                font: 'normal 10px Verdana, sans-serif'
            }
         }
      },
        yAxis: {
                 min: 0,
                 title: {
                    text: 'Outside spending for/against'
                 }
              },
       plotOptions: {
         column: {
            stacking: 'normal'
         }
        },

        tooltip: {
                 formatter: function() {
                    return '<b>$'+ Math.round(this.y);
                 }
      },
        series: [
                { data: [{% for candidate in top_candidates|slice:"5" %}{{ candidate.amount }}{% if not forloop.last %},{% endif %}{% endfor %}]
                }
                ],
        legend: { enabled: false }
    });

});
</script>


{% load media %}
{% load humanize %}

{% js "js/highcharts.js" %}

<style type="text/css">
    /*table { border-collapse: collapse; }*/
    /*td, th { border: 1px solid black; padding: 4px; }*/
    h3 { text-align: center; }
</style>

<div style="width: 300px; float: right;">
<h4>Recent big spending</h4>
<table id="expendituresData">
    {% for expenditure in latest_big_expenditures|slice:"12" %}
    <tr class="{% cycle 'odd' 'even' %}">
        <td>
            {% if expenditure.electioneering_communication %}
            {{ expenditure.committee }}: ${{ expenditure.expenditure_amount|intcomma }} electioneering communication mentioning {% for candidate in expenditure.electioneering_candidates.all %}{{ candidate }}{% if candidate.race %} ({{ candidate.full_race_name }}){% endif %}{% if not forloop.last %}, {% endif %}{%endfor %}
            {% else %}
            {{ expenditure.committee }}: ${{ expenditure.expenditure_amount|intcomma }} {% ifequal expenditure.support_oppose 'S' %}supporting{% endifequal %}{% ifequal expenditure.support_oppose 'O' %}opposing{% endifequal %} {{ expenditure.candidate }} {% if expenditure.candidate.race %}({{ expenditure.candidate.full_race_name }}){% endif %}
            {% endif %}
            <a href="{{ expenditure.get_absolute_url }}#{{ expenditure.pk }}">{{ expenditure.expenditure_date }}</a>
        </td>
    </tr>
    {% endfor %}
</table>
</div>

<div style="width: 500px; margin-right: 100px;">
<h3>Totals this election cycle</h3>
<table id="expendituresData">
    <thead>
        <tr>
            <th></th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody>
        <tr class="odd">
            <td><strong>Independent expenditures</strong></td>
            <td>${{ total.ie_total|intcomma }}</td>
        </tr>
        <tr class="even">
            <td><strong>Electioneering communications</strong></td>
            <td>${{ total.ec_total|intcomma }}</td>
        </tr>
        <tr class="odd">
            <td><strong>Total</strong></td>
            <td>${{ total.total|intcomma }}</td>
        </tr>
    </tbody>
</table>


<div id="outside-spending-pie" style="width: 100%; height: 400px"></div>

<br><br>

<h3>Spending by political party</h3>
<table>
    <thead>
        <tr>
            <th></th>
            <th>By Non-Party Committees</th>
            <th>By Party Committees</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        <tr class="odd">
            <td><strong>Supporting Republicans</strong></td>
            <td>${{ total.republican_support_nonparty|intcomma }}</td>
            <td>${{ total.republican_support_party|intcomma }}</td>
            <td>${{ total.republican_support_total|intcomma }}</td>
        </tr>
        <tr class="even">
            <td><strong>Opposing Republicans</strong></td>
            <td>${{ total.republican_oppose_nonparty|intcomma }}</td>
            <td>${{ total.republican_oppose_party|intcomma }}</td>
            <td>${{ total.republican_oppose_total|intcomma }}</td>
        </tr>
        <tr class="odd">
            <td><strong>Supporting Democrats</strong></td>
            <td>${{ total.democrat_support_nonparty|intcomma }}</td>
            <td>${{ total.democrat_support_party|intcomma }}</td>
            <td>${{ total.democrat_support_total|intcomma }}</td>
        </tr>
        <tr class="even">
            <td><strong>Opposing Democrats</strong></td>
            <td>${{ total.democrat_oppose_nonparty|intcomma }}</td>
            <td>${{ total.democrat_oppose_party|intcomma }}</td>
            <td>${{ total.democrat_oppose_total|intcomma }}</td>
        </tr>
    </tbody>
</table>

<div id="party-pie" style="width: 100%; height: 400px"></div>
<div id="party-committee-pie" style="width: 100%; height: 400px"></div>


<br><br>

<h3>Top spenders in the past 4 days</h3>
<table>
    <thead>
        <tr>
            <th>Committee</th>
            <th>Outside spending</th>
        </tr>
    </thead>
    <tbody>
        {% for committee in top_committees|slice:"5" %}
        <tr class="{% cycle 'odd' 'even' %}">
            <td><a href="{{ committee.committee.get_absolute_url }}">{{ committee.committee }}</a></td>
            <td>${{ committee.amount|intcomma }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div id="committee-barchart" style="width: 100%; height: 400px"></div>

<br><br>

<h3>Top races in the past 4 days</h3>
<table>
    <thead>
        <tr>
            <th>Race</th>
            <th>Outside spending</th>
        </tr>
    </thead>
    <tbody>
        {% for race in top_races|slice:"5" %}
        <tr class="{% cycle 'odd' 'even' %}">
            <td><a href="{% url buckley_race_detail race=race.race %}">{{ race.race }}</a></td>
            <td>${{ race.amount|intcomma }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div id="race-barchart" style="width: 100%; height: 400px"></div>

<br><br>

<h3>Top candidates in the past 4 days</h3>
<table>
    <thead>
        <tr>
            <th>Candidate</th>
            <th>Outside spending</th>
        </tr>
    </thead>
    <tbody>
        {% for candidate in top_candidates|slice:"5" %}
        <tr class="{% cycle 'odd' 'even' %}">
            <td><a href="{{ candidate.get_absolute_url }}">{{ candidate.candidate }}</a></td>
            <td>${{ candidate.amount|intcomma }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div id="candidate-barchart" style="width: 100%; height: 400px"></div>

</div>


{% endblock content %}
