{% extends "base.html" %}
{% load media %}

{% block body %}fullWidth{% endblock %}

{% block feature %}
<style type="text/css">
	#fullColumn { font-family: sans-serif; }
	#chart-container { margin: 0; padding: 0; float: left; width: auto; }
	#chart-bar { margin: 0; padding: 0; position: relative; top: -40px; left: 0; }
	#ctlbar { float: left; position: relative; left: -30px; width: 130px; background-color: #dddcd8; padding: 12px; margin: 0; } 
	.presidenttitle { display: inline-block; font-weight: bold; color: #5e5e5e; font-size: 10pt; }
	.termyears { font-style: italic; color: #939290; font-size: 9pt; }
	.yearlist { color: #5e5e5e; font-weight: normal; font-size: 11pt; }
	ul#clinton-budgets > li > input, ul#bush-budgets > li > input, ul#obama-budgets > li > input { width: auto; margin: 0 2pt 0 0; }
	div.collapsable { width: auto; margin: 7px 0 18px 0; padding: 0; }
	div.collapsable div.list-bullet { display: inline-block; vertical-align: top; padding: 0; margin: 0; width: 12px; height: 12px; background: url({% media_url %}/img/budgetforecasts/icons_arrows.png) no-repeat; }
	div.collapsable div.list-bullet-open { display: inline-block; background-position: 0 -11px; }
	div.collapsable div.list-bullet-closed { display: inline-block; background-position 0 0; }
	div.collapsable ul { margin: 0; padding: 0 0 0 1em; }
	div.collapsable li { list-style-type: none; list-style-image: none; }
	#loading { color: #3a7982; font-size: 120%; font-weight: bold; }
	#budget-title { margin: 0 0 12pt 0; color: #3a7982; font-size: 28pt; font-weight: 500; font-family: serif; }
	#billions-label { font-size: 10pt; font-style: italic; display: none; }
	.explain { color: #58595B; font-size: 120%; margin: 0 0 12pt 0; }
	.clear { clear: both; } 
</style>
<script src="{% media_url %}/js/highstock.src.js"></script>
<script type="text/javascript">
	var balances = [
		[Date.UTC(1995, 0, 1), -163.952],
		[Date.UTC(1996, 0, 1), -107.431],
		[Date.UTC(1997, 0, 1), -21.884],
		[Date.UTC(1998, 0, 1), 69.270],
		[Date.UTC(1999, 0, 1), 125.610],
		[Date.UTC(2000, 0, 1), 236.241],
		[Date.UTC(2001, 0, 1), 128.236],
		[Date.UTC(2002, 0, 1), -157.758],
		[Date.UTC(2003, 0, 1), -377.585],
		[Date.UTC(2004, 0, 1), -412.727],
		[Date.UTC(2005, 0, 1), -318.346],
		[Date.UTC(2006, 0, 1), -248.181],
		[Date.UTC(2007, 0, 1), -160.701],
		[Date.UTC(2008, 0, 1), -458.555],
		[Date.UTC(2009, 0, 1), -1412.686],
		[Date.UTC(2010, 0, 1), -1293.489]
	];

	var debt = [
		[Date.UTC(2021, 8, 30), null],
		[Date.UTC(2010, 8, 30), 13561623030891.79],
		[Date.UTC(2009, 8, 30), 11909829003511.75],
		[Date.UTC(2008, 8, 30), 10024724896912.49],
		[Date.UTC(2007, 8, 30), 9007653372262.48],
		[Date.UTC(2006, 8, 30), 8506973899215.23],
		[Date.UTC(2005, 8, 30), 7932709661723.50],
		[Date.UTC(2004, 8, 30), 7379052696330.32],
		[Date.UTC(2003, 8, 30), 6783231062743.62],
		[Date.UTC(2002, 8, 30), 6228235965597.16],
		[Date.UTC(2001, 8, 30), 5807463412200.06],
		[Date.UTC(2000, 8, 30), 5674178209886.86],
		[Date.UTC(1999, 8, 30), 5656270901615.43],
		[Date.UTC(1998, 8, 30), 5526193008897.62],
		[Date.UTC(1997, 8, 30), 5413146011397.34],
		[Date.UTC(1996, 8, 30), 5224810939135.73],
		[Date.UTC(1995, 8, 30), 4973982900709.39],
		[Date.UTC(1994, 8, 30), 4692749910013.32],
		[Date.UTC(1994, 0, 1), null]
	];

	var budgets = {
		'Clinton': {
			'1996': [
				[Date.UTC(1995, 0, 1), -192.506], 
				[Date.UTC(1996, 0, 1), -196.671], 
				[Date.UTC(1997, 0, 1), -213.091], 
				[Date.UTC(1998, 0, 1), -196.376], 
				[Date.UTC(1999, 0, 1), -197.446], 
				[Date.UTC(2000, 0, 1), -194.426]
			],
			'1997': [
				[Date.UTC(1996, 0, 1), -145.636],
				[Date.UTC(1997, 0, 1), -140.091],
				[Date.UTC(1998, 0, 1), -97.952],
				[Date.UTC(1999, 0, 1), -64.403],
				[Date.UTC(2000, 0, 1), -27.549],
				[Date.UTC(2001, 0, 1), 8.265],
				[Date.UTC(2002, 0, 1), 43.902]
			],
			'1998': [
				[Date.UTC(1997, 0, 1), -125.591],
				[Date.UTC(1998, 0, 1), -120.633],
				[Date.UTC(1999, 0, 1), -117.380],
				[Date.UTC(2000, 0, 1), -87.123],
				[Date.UTC(2001, 0, 1), -36.141],
				[Date.UTC(2002, 0, 1), 16.969]
			],
			'1999': [
				[Date.UTC(1998, 0, 1), -9.957],
				[Date.UTC(1999, 0, 1), 9.519],
				[Date.UTC(2000, 0, 1), 8.530],
				[Date.UTC(2001, 0, 1), 28.190],
				[Date.UTC(2002, 0, 1), 89.745],
				[Date.UTC(2003, 0, 1), 82.783],
				[Date.UTC(2004, 0, 1), 111.500],
				[Date.UTC(2005, 0, 1), 139.000],
				[Date.UTC(2006, 0, 1), 166.800],
				[Date.UTC(2007, 0, 1), 219.000],
				[Date.UTC(2008, 0, 1), 261.300]
			],
			'2000': [
				[Date.UTC(1999, 0, 1), 79.263],
				[Date.UTC(2000, 0, 1), 117.305],
				[Date.UTC(2001, 0, 1), 134.100],
				[Date.UTC(2002, 0, 1), 186.745],
				[Date.UTC(2003, 0, 1), 182.042],
				[Date.UTC(2004, 0, 1), 207.623],
				[Date.UTC(2005, 0, 1), 231.000],
				[Date.UTC(2006, 0, 1), 283.000],
				[Date.UTC(2007, 0, 1), 320.000],
				[Date.UTC(2008, 0, 1), 354.000],
				[Date.UTC(2009, 0, 1), 393.000]
			],
			'2001': [
				[Date.UTC(2000, 0, 1), 166.690],
				[Date.UTC(2001, 0, 1), 183.998],
				[Date.UTC(2002, 0, 1), 185.903],
				[Date.UTC(2003, 0, 1), 184.636],
				[Date.UTC(2004, 0, 1), 194.960],
				[Date.UTC(2005, 0, 1), 215.445],
				[Date.UTC(2006, 0, 1), 256.000],
				[Date.UTC(2007, 0, 1), 292.000],
				[Date.UTC(2008, 0, 1), 314.000],
				[Date.UTC(2009, 0, 1), 329.000],
				[Date.UTC(2010, 0, 1), 363.000]
			]
		},
		'Bush': {
			'2002': [
				[Date.UTC(2001, 0, 1), 280.708],
				[Date.UTC(2002, 0, 1), 231.170],
				[Date.UTC(2003, 0, 1), 242.014],
				[Date.UTC(2004, 0, 1), 262.098],
				[Date.UTC(2005, 0, 1), 269.038],
				[Date.UTC(2006, 0, 1), 304.809],
				[Date.UTC(2007, 0, 1), 34.000],
				[Date.UTC(2008, 0, 1), 373.000],
				[Date.UTC(2009, 0, 1), 420.000],
				[Date.UTC(2010, 0, 1), 465.000],
				[Date.UTC(2011, 0, 1), 526.000]
			],
			'2003': [
				[Date.UTC(2002, 0, 1), -106.184],
				[Date.UTC(2003, 0, 1), -80.170],
				[Date.UTC(2004, 0, 1), -13.741],
				[Date.UTC(2005, 0, 1), 61.139],
				[Date.UTC(2006, 0, 1), 86.196],
				[Date.UTC(2007, 0, 1), 103.970]
			],
			'2004': [
				[Date.UTC(2003, 0, 1), -304.159],
				[Date.UTC(2004, 0, 1), -307.400],
				[Date.UTC(2005, 0, 1), -208.211],
				[Date.UTC(2006, 0, 1), -200.504],
				[Date.UTC(2007, 0, 1), -178.149],
				[Date.UTC(2008, 0, 1), -189.594]
			],
			'2005': [
				[Date.UTC(2004, 0, 1), -520.741],
				[Date.UTC(2005, 0, 1), -363.570],
				[Date.UTC(2006, 0, 1), -267.632],
				[Date.UTC(2007, 0, 1), -241.272],
				[Date.UTC(2008, 0, 1), -238.969],
				[Date.UTC(2009, 0, 1), -237.076]
			],
			'2006': [
				[Date.UTC(2005, 0, 1), -426.600],
				[Date.UTC(2006, 0, 1), -390.100],
				[Date.UTC(2007, 0, 1), -312.100],
				[Date.UTC(2008, 0, 1), -250.800],
				[Date.UTC(2009, 0, 1), -232.900],
				[Date.UTC(2010, 0, 1), -207.300]
			],
			'2007': [
				[Date.UTC(2006, 0, 1), -423.186],
				[Date.UTC(2007, 0, 1), -354.245],
				[Date.UTC(2008, 0, 1), -223.334],
				[Date.UTC(2009, 0, 1), -207.553],
				[Date.UTC(2010, 0, 1), -182.708],
				[Date.UTC(2011, 0, 1), -204.908]
			],
			'2008': [
				[Date.UTC(2007, 0, 1), -244.171],
				[Date.UTC(2008, 0, 1), -239.387],
				[Date.UTC(2009, 0, 1), -187.166],
				[Date.UTC(2010, 0, 1), -94.361],
				[Date.UTC(2011, 0, 1), -53.774],
				[Date.UTC(2012, 0, 1), 61.018]
			],
			'2009': [
				[Date.UTC(2008, 0, 1), -410.047],
				[Date.UTC(2009, 0, 1), -407.408],
				[Date.UTC(2010, 0, 1), -159.992],
				[Date.UTC(2011, 0, 1), -94.810],
				[Date.UTC(2012, 0, 1), 48.050],
				[Date.UTC(2013, 0, 1), 29.349]
			]
		},
		'Obama': {
			'2010': [
				[Date.UTC(2009, 0, 1), -1841.188],
				[Date.UTC(2010, 0, 1), -1258.431],
				[Date.UTC(2011, 0, 1), -929.416],
				[Date.UTC(2012, 0, 1), -557.419],
				[Date.UTC(2013, 0, 1), -512.322],
				[Date.UTC(2014, 0, 1), -535.896],
				[Date.UTC(2015, 0, 1), -583.000],
				[Date.UTC(2016, 0, 1), -637.000],
				[Date.UTC(2017, 0, 1), -636.000],
				[Date.UTC(2018, 0, 1), -634.000],
				[Date.UTC(2019, 0, 1), -712.000]
			],
			'2011': [
				[Date.UTC(2010, 0, 1), -1555.582],
				[Date.UTC(2011, 0, 1), -1266.680],
				[Date.UTC(2012, 0, 1), -828.452],
				[Date.UTC(2013, 0, 1), -727.328],
				[Date.UTC(2014, 0, 1), -705.779],
				[Date.UTC(2015, 0, 1), -751.852],
				[Date.UTC(2016, 0, 1), -778.000],
				[Date.UTC(2017, 0, 1), -785.000],
				[Date.UTC(2018, 0, 1), -785.000],
				[Date.UTC(2019, 0, 1), -908.000],
				[Date.UTC(2020, 0, 1), -1003.000]
			],
			'2012': [
				[Date.UTC(2011, 0, 1), -1645.119],
				[Date.UTC(2012, 0, 1), -1101.237],
				[Date.UTC(2013, 0, 1), -767.531],
				[Date.UTC(2014, 0, 1), -644.553],
				[Date.UTC(2015, 0, 1), -606.730],
				[Date.UTC(2016, 0, 1), -648.703],
				[Date.UTC(2017, 0, 1), -627.000],
				[Date.UTC(2018, 0, 1), -619.000],
				[Date.UTC(2019, 0, 1), -681.000],
				[Date.UTC(2020, 0, 1), -735.000],
				[Date.UTC(2021, 0, 1), -774.000]
			]
		}
	};
</script>
<script type="text/javascript">
$(function(){
	// JAVASCRIPT 1.6 COMPATIBILITY PATCH FROM MDN
	if (!Array.prototype.filter) {  
		Array.prototype.filter = function(fun /*, thisp */)  
		{  
			"use strict";  

			if (this === void 0 || this === null)  
				throw new TypeError();  

				var t = Object(this);  
				var len = t.length >>> 0;  
				if (typeof fun !== "function")  
					throw new TypeError();  

				var res = [];  
				var thisp = arguments[1];  
				for (var i = 0; i < len; i++)  
				{  
					if (i in t)  
					{  
						var val = t[i]; // in case fun mutates this  
						if (fun.call(thisp, val, i, t))  
							res.push(val);  
					}  
				}  

			return res;  
		};  
	}


	if (!Date.prototype.getMonthName) {
		Date.prototype.getMonthName = function() {
			var names = ['January', 'February', 'March', 'April',
						 'May', 'June', 'July', 'August', 'September',
						 'October', 'November', 'December'],
				month = this.getMonth(),
				name = names[month];
			return name;
		};
	}


	// CHART CODE
	function formatEstimateLabel () {
		if (this.series.name == 'Event Flags') {
			var event_date = new Date(this.x),
				event_month = event_date.getMonthName().substr(0, 3),
				day = event_date.getDate(),
				year = event_date.getFullYear();
			return '<b>' + this.point.text + '</b></span><br>' + event_month + ' ' + day + ', ' + year;
		} else {
			if (this.series.name == 'Actual Balances') {
				var balance_date = new Date(this.x),
					balance_year = balance_date.getFullYear();
			        lines = [
					'<b>' + balance_year + ' Actual Balance:</b>',
					'$' + this.y
					];
				return lines.join('<br>');
			} else {
				var parts = this.series.name.split(' '),
					budget_year = parts[1],
					president = parts[0],
					estimate_date = new Date(this.x),
					estimate_year = estimate_date.getFullYear();
				var lines = [
					'<b>' + budget_year + ' Budget</b> (' + president + ')',
					estimate_year + ' Estimate: $' + this.y
				];

				return lines.join('<br>');
			}
		}
	};

	$(document).ready(function(){
	var seriesOptions = [],
		yAxisOptions = [],
		colors = [],
		seriesCounter = 1;

	seriesOptions[0] = {
		name: 'Actual Balances',
		data: balances,
		yAxis: 0,
		dashStyle: 'solid',
		lineWidth: 1,
		states: {
			hover: {
				lineWidth: 2
			}
		}
	};
	colors[0] = '#e76625';

	for (var president in budgets) {
		for (var year in budgets[president]) {
			var budget = budgets[president][year];
			seriesOptions[seriesCounter] = {
				name: president + ' ' + year,
				visible: false,
				data: budget,
				yAxis: 1,
				color: '#3a7c7b',
				states: {
				    hover: {
					    color: '#e8c72a',
						lineWidth: 2
					}
				}
			};

			seriesCounter += 1;
		}
	}

	seriesOptions[seriesCounter] = {
		type: 'scatter',
		marker: {
			enabled: true,
			symbol: 'url({% media_url %}/img/budgetforecasts/icons_events_white.png)',
			animation: false
		},
		states: { 
			hover: { enabled: false }, 
			'': { enabled: false } 
		},
		y: -10,
		shadow: false,
		id: 'event-flags',
		name: 'Event Flags',
		data: [{ x: Date.UTC(2005, 07, 29),
				 y: -1870,
				 title: ' ',
				 text: 'Hurricane Katrina',
			   }]
	};
	seriesCounter += 1;

	var chart_parent = document.getElementById("chart-container").parentNode,
		chart_width = $(chart_parent).width() - 154;
	Chart = new Highcharts.StockChart({
				chart: {
					animation: false,
					backgroundColor: 'none',
					plotBackgroundImage: '{% media_url %}/img/budgetforecasts/bg_vis4.png',
					renderTo: 'chart-container',
					width: chart_width,
					alignTicks: false
				},
				credits: {
					enabled: false
				},
				scrollbar: {
					enabled: false
				},
				navigator: {
					enabled: false
				},
				rangeSelector: {
					enabled: false
				},
				xAxis: {
					type: 'datetime',
					tickLength: 10,
					labels: {
						style: { 
							color: '#939290',
							fontWeight: 'bolder',
							fontStyle: 'italic',
							letterSpacing: '109%'
						},
						y: 26
					},
					min: Date.UTC(1994, 0, 1),
					max: Date.UTC(2020, 0, 1)
				},
				plotOptions: {
					line: {
						dashStyle: 'shortdash',
						dataLabels: {
							color: '#80807e'
						},
						lineWidth: 1,
						states: {
							hover: {
								enabled: true,
								color: '#00ff00',
								lineWidth: 1
							}
						}
					}
				},
				tooltip: {
					formatter: formatEstimateLabel,
					shared: false,
					borderRadius: 0,
					borderWidth: 2,
					borderColor: '#ddded9',
					backgroundColor: '#f7f7f5',
					style: {
						color: '#80807e'
					}
				},
				yAxis: [ { alternateGridColor: null,
						   gridLineWidth: 0,
						   lineWidth: 0,
						   max: 1000,
						   min: -2000,
						   tickPixelInterval: 57,
						   opposite: true,
						   showFirstLabel: false,
						   labels: { enabled: false }
						 },
						 { alternateGridColor: null,
						   gridLineWidth: 0,
						   lineWidth: 0,
						   max: 1000,
						   min: -2000,
						   tickPixelInterval: 57,
						   opposite: false,
						   showFirstLabel: false,
						   labels: { 
							   formatter: function(){ return '$' + this.value; },
							   style: { 
								   color: '#939290',
								   fontWeight: 'bolder',
								   fontStyle: 'italic',
								   letterSpacing: '109%'
							   },
							   x: -10,
							   align: 'right'
						   }
						 }
				],
				series: seriesOptions,
				colors: colors,
				labels: []
			});
		$("#billions-label").show();
		$("#loading").hide();
		console.log(Chart);

		$("input.series-toggle").click(function(event){
			var series_name = $(event.currentTarget).attr("name")
													.toLowerCase()
													.replace('-', ' '),
				matcher = function(s){ return s.name.toLowerCase() == series_name; },
				series = Chart.series.filter(matcher);
			if (series.length == 0) {
				if (console != null) {
					throw ("Series not found: " + series_name);
				}
			} else if ($(event.currentTarget).attr("checked") == true) {
				series[0].show();
				Chart.redraw();
			} else {
				series[0].hide();
				Chart.redraw();
			}
		});

		$(".list-bullet").click(function(event){
			$(event.currentTarget).toggleClass("list-bullet-open");
			$(event.currentTarget).toggleClass("list-bullet-closed");
			if ($(event.currentTarget).hasClass("list-bullet-closed")) {
				$("ul", event.currentTarget.parentNode).hide();
			} else {
				$("ul", event.currentTarget.parentNode).show();
			}
		});
	});

});
</script>
<div id="columns">
    <div id="fullColumn" style="overflow:hidden;">
		<div id="budget-title">Budget Forecasts vs. Budget Realities</div>
		<div id="budget-explain" class="explain">When a proposed U.S. federal budget is presented to congress, it includes forecasts for up to 10 years out. How well do these forecasts match up with reality? We've analyzed past budgets and actual government income and spending to develop the chart below, showing that forecasts rarely match up with reality.</div>
        <div id="ctlbar">
            <div class="collapsable">
                <div class="list-bullet list-bullet-open"></div>
                <div class="presidenttitle">
                    <span>Budgets under <br> Bill Clinton</span>
                    <br>
                    <span class="termyears">(1995 - 2001)</span>
                </div>
                <ul id="clinton-budgets" class="yearlist">
                    <li><input type="checkbox" name="Clinton-1996" id="Clinton-1996" class="series-toggle">1996</li>
                    <li><input type="checkbox" name="Clinton-1997" id="Clinton-1997" class="series-toggle">1997</li>
                    <li><input type="checkbox" name="Clinton-1998" id="Clinton-1998" class="series-toggle">1998</li>
                    <li><input type="checkbox" name="Clinton-1999" id="Clinton-1999" class="series-toggle">1999</li>
                    <li><input type="checkbox" name="Clinton-2000" id="Clinton-2000" class="series-toggle">2000</li>
                    <li><input type="checkbox" name="Clinton-2001" id="Clinton-2001" class="series-toggle">2001</li>
                </ul>
            </div>

            <div class="collapsable">
                <div class="list-bullet list-bullet-open"></div>
                <div class="presidenttitle">
                    <span>Budgets under <br> George W. Bush</span>
                    <br>
                    <span class="termyears">(2001 - 2009)</span>
                </div>
                <ul id="bush-budgets" class="yearlist">
                    <li><input type="checkbox" name="Bush-2002" id="Bush-2002" class="series-toggle">2002</li>
                    <li><input type="checkbox" name="Bush-2003" id="Bush-2003" class="series-toggle">2003</li>
                    <li><input type="checkbox" name="Bush-2004" id="Bush-2004" class="series-toggle">2004</li>
                    <li><input type="checkbox" name="Bush-2005" id="Bush-2005" class="series-toggle">2005</li>
                    <li><input type="checkbox" name="Bush-2006" id="Bush-2006" class="series-toggle">2006</li>
                    <li><input type="checkbox" name="Bush-2007" id="Bush-2007" class="series-toggle">2007</li>
                    <li><input type="checkbox" name="Bush-2008" id="Bush-2008" class="series-toggle">2008</li>
                    <li><input type="checkbox" name="Bush-2009" id="Bush-2009" class="series-toggle">2009</li>
                </ul>
            </div>
        
            <div class="collapsable">
                <div class="list-bullet list-bullet-open"></div>
                <div class="presidenttitle">
                    <span>Budgets under <br> Barack Obama</span>
                    <br>
                    <span class="termyears">(2009 - 2011)</span>
                </div>
                <ul id="obama-budgets" class="yearlist">
                    <li><input type="checkbox" name="Obama-2010" id="Obama-2010" class="series-toggle">2010</li>
                    <li><input type="checkbox" name="Obama-2011" id="Obama-2011" class="series-toggle">2011</li>
                    <li><input type="checkbox" name="Obama-2012" id="Obama-2012" class="series-toggle">2012</li>
                </ul>
            </div>
        </div>
		<span id="billions-label" class="explain">In Billions</span>
        <div id="chart-container">
			<span id="loading">Loading...</span>
        </div>
        <div class="clear"></div>
	</div>
</div>
{% endblock %}
