<html>
<head> <title>Sunlight's Recovery Explorer</title>
<script src="http://assets.sunlightfoundation.com.s3.amazonaws.com/reporting/1.0/millions/jquery.js" type="text/javascript"></script> 
<script src="http://assets.sunlightfoundation.com.s3.amazonaws.com/reporting/1.0/millions/interface.js" type="text/javascript"></script> 
<script src="http://assets.sunlightfoundation.com.s3.amazonaws.com/reporting/1.0/millions/treemap.js" type="text/javascript"></script> 


 
<script type="text/javascript"> 

jQuery(function(){
		var data = getData();
		var tree = jQuery("#treemap").treemap(950,750,{getData:function(){return data;}});
		enhanceTreemap(tree,data);
        jQuery("select",this).each(function(){   greyxyfromfilter(this); });  
	});
	
	function enhanceTreemap(t,data) {
		jQuery("div.treemapCell",t).hover(function(){jQuery(this).addClass("selected")},function(){jQuery(this).removeClass("selected")});
		jQuery("div.treemapHead",t).click(function(){
			var cell = jQuery(this);
			var transferComplete = function() {
				var tree = jQuery("<div>").
				treemap(950,750,{getData:function(){
					var branch = cell.html();
					for(var i=0,dl=data.length;i<dl;i++)
						if(data[i][0]==branch) return data[i][1];
				}})
				.css({"position":"absolute","top":t[0].offsetTop,"left":t[0].offsetLeft,"z-index":1});
				enhanceTreemap(tree,data);
				jQuery("<a href='#'>").
				css({"cursor":"pointer","position":"absolute","top":t[0].offsetTop,"left":t[0].offsetLeft+1000}).
				html("return to main view").
				click(function(){tree.add(this).remove();return false;}).
				appendTo("body");
				tree.appendTo("body");
			};
			cell.TransferTo({to:t[0],duration:"normal",className:"transfer",complete:transferComplete});
		})
	}
	
	function getData() {
		var data = [];
		var cont = {};
		jQuery("#treemap tr",this).each(function(){
			var cell = jQuery("td",this);
			if(!cell.length) return;
			var c = cell.filter(":eq(1)").html();
            var c2 = cell.filter(":eq(2)").html();
			if(!cont[c]) cont[c] = [];
			var num = cell.filter(":eq(0)").html();
			var formatnum = addCommas(num);
            var row = ['<a href="../detail?award_key='+cell.filter(":eq(3)").html()+'">'+cell.filter(":eq(2)").html()+"<small> ("+formatnum+")</small></a>",num];
			cont[c].push(row);
		});
		jQuery.each(cont,function(i,n){
			data.push([i,n]);
		})
		
		return data;
	}



 function addCommas(nStr) {
    	nStr += '';
	    x = nStr.split('.');
	    x1 = x[0];
	    x2 = x.length > 1 ? '.' + x[1] : '';
	    var rgx = /(\d+)(\d{3})/;
	    while (rgx.test(x1)) {
	    	x1 = x1.replace(rgx, '$1' + ',' + '$2');
	    }
	    return x1;
    }


	</script> 
<style type="text/css"> 

body { font-family:helvetica; // needs full font stack}
 
  	.treemapCell {background-color:#BAE4B3; font-size: 9pt; }
  	.treemapHead {cursor:pointer;background-color:#74C476}
		.treemapCell.selected, .treemapCell.selected .treemapCell.selected {background-color:#EDF8E9}
  	.treemapCell.selected .treemapCell {background-color:#31A354}
  	.treemapCell.selected .treemapHead {background-color:#006D2C}
  	.transfer {border:1px solid black}

.treemapCell a {text-decoration: none; }
 
#options_1 { margin:0; padding:0;}
#options_1 li { list-style:none; margin:0 40px 0px 30px; float:left;}
#clearfix { clear:both;}
#page { margin-bottom:20px; float:left; margin-right:20px;}
#group1 { margin-left:30px; padding-top:20px;}
.lineitem { background-color:#eeeeee; margin-bottom:1px; padding:5px; width:300px;}
 
legend { font-weight:bold;}
 
#the_form { width:1000px;}
#sumby { }
#sumlist li {list-style:none; margin:0 40px 0px 30px;}
</style> 	
</head> 
<body> 
{%load tags%}


<h3>All stimulus money for {{ recipient }}</h3>

<table id="treemap">
{%for r in recs%}
<tr>
<td>{{    r.0 }}</td>
<td>{{    r.1  }}</td>
<td>{{    r.2  }}</td>
<td>{{    r.3  }}</td>
</tr>
{%endfor%}
</table>





</body></html>
